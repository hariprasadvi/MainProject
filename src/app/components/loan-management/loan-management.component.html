<div class="loan-management-container">
  <h2>Loan Management</h2>
  
  <div class="loan-sections">
    <mat-card class="apply-loan-section">
      <mat-card-header>
        <mat-card-title>Apply for Loan</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="loanForm" (ngSubmit)="applyForLoan()" class="loan-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Loan Amount (₹)</mat-label>
            <input 
              matInput 
              type="number" 
              formControlName="amount" 
              placeholder="Enter amount">
            @if (loanForm.get('amount')?.hasError('required')) {
              <mat-error>Amount is required</mat-error>
            }
            @if (loanForm.get('amount')?.hasError('min')) {
              <mat-error>Minimum loan amount is ₹1000</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Loan Purpose</mat-label>
            <input 
              matInput 
              formControlName="purpose" 
              placeholder="Purpose of loan">
            @if (loanForm.get('purpose')?.hasError('required')) {
              <mat-error>Purpose is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description (Optional)</mat-label>
            <textarea 
              matInput 
              formControlName="description" 
              rows="3"
              placeholder="Additional details about the loan requirement">
            </textarea>
          </mat-form-field>

          <button 
            mat-raised-button 
            color="primary" 
            type="submit"
            [disabled]="!loanForm.valid">
            Apply for Loan
          </button>
        </form>
      </mat-card-content>
    </mat-card>

    <mat-card class="loan-history-section">
      <mat-card-header>
        <mat-card-title>Loan Applications</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        @if (loans.length > 0) {
          <table mat-table [dataSource]="loans" class="full-width">
            <ng-container matColumnDef="loanNumber">
              <th mat-header-cell *matHeaderCellDef>Loan ID</th>
              <td mat-cell *matCellDef="let loan">{{ loan.loanNumber }}</td>
            </ng-container>

            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Amount</th>
              <td mat-cell *matCellDef="let loan">₹{{ loan.amount }}</td>
            </ng-container>

            <ng-container matColumnDef="purpose">
              <th mat-header-cell *matHeaderCellDef>Purpose</th>
              <td mat-cell *matCellDef="let loan">{{ loan.purpose }}</td>
            </ng-container>

            <ng-container matColumnDef="appliedDate">
              <th mat-header-cell *matHeaderCellDef>Applied Date</th>
              <td mat-cell *matCellDef="let loan">{{ loan.appliedDate | date:'mediumDate' }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let loan">
                <span [class]="getStatusClass(loan.status)">
                  {{ loan.status }}
                </span>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        } @else {
          <div class="no-data">
            <p>No loan applications found.</p>
          </div>
        }
      </mat-card-content>
    </mat-card>
  </div>
</div>